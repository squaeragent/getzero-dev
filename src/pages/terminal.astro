---
// No server-side logic — pure client-side terminal
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ZERO OS — Terminal</title>
  <meta name="description" content="ZERO OS interactive terminal interface" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      overflow: hidden;
      background: #0a0a0a;
    }

    .terminal-screen {
      background: #0a0a0a;
      min-height: 100vh;
      height: 100vh;
      padding: 20px;
      padding-bottom: 80px;
      font-family: 'JetBrains Mono', 'DM Mono', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      color: #c8ff00;
      position: relative;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .terminal-screen::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.15) 0px,
        rgba(0,0,0,0.15) 1px,
        transparent 1px,
        transparent 3px
      );
      pointer-events: none;
      z-index: 10;
    }

    .output-line { white-space: pre-wrap; word-break: break-word; }
    .output-line.dim { color: #5a6a00; }

    .input-line {
      display: flex;
      align-items: center;
      white-space: pre;
    }

    .prompt { color: #c8ff00; user-select: none; }

    #input {
      background: none;
      border: none;
      outline: none;
      color: #c8ff00;
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      flex: 1;
      caret-color: #c8ff00;
      padding: 0;
    }

    .cursor-block {
      display: inline-block;
      width: 0.6em;
      height: 1.15em;
      background: #c8ff00;
      vertical-align: text-bottom;
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    .exit-hint {
      position: fixed;
      top: 10px;
      right: 16px;
      color: #3a4a00;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      z-index: 20;
      user-select: none;
    }
    .exit-hint a { color: #5a6a00; text-decoration: none; }
    .exit-hint a:hover { color: #c8ff00; }

    @media (max-width: 768px) {
      .terminal-screen { font-size: 13px; padding: 14px; padding-bottom: 80px; }
    }
    @media (max-width: 375px) {
      .terminal-screen { font-size: 12px; padding: 10px; padding-bottom: 80px; }
    }
  </style>
</head>
<body>
  <div class="exit-hint"><a href="/">← back to site</a></div>
  <div class="terminal-screen" id="screen">
    <div id="output"></div>
    <div class="input-line" id="input-row">
      <span class="prompt">zero $&nbsp;</span>
      <input type="text" id="input" autocomplete="off" autocapitalize="none" spellcheck="false" autofocus />
    </div>
  </div>

  <script>
    const output = document.getElementById('output');
    const input = document.getElementById('input');
    const screen = document.getElementById('screen');
    const inputRow = document.getElementById('input-row');

    let history = [];
    let historyIdx = -1;
    let cache = {};
    let typing = false;

    // Scroll to bottom
    function scrollBottom() {
      screen.scrollTop = screen.scrollHeight;
    }

    // Print line instantly
    function printLine(text, cls) {
      const div = document.createElement('div');
      div.className = 'output-line' + (cls ? ' ' + cls : '');
      div.textContent = text;
      output.appendChild(div);
      scrollBottom();
    }

    // Type out text char by char
    function typeLines(text, speed = 18) {
      return new Promise(resolve => {
        typing = true;
        inputRow.style.display = 'none';
        const div = document.createElement('div');
        div.className = 'output-line';
        output.appendChild(div);
        let i = 0;
        const chars = text;
        function next() {
          if (i < chars.length) {
            div.textContent += chars[i];
            i++;
            if (chars[i - 1] === '\n') scrollBottom();
            setTimeout(next, speed);
          } else {
            typing = false;
            inputRow.style.display = 'flex';
            input.focus();
            scrollBottom();
            resolve();
          }
        }
        next();
      });
    }

    // Fetch with cache
    async function fetchJSON(url) {
      if (cache[url]) return cache[url];
      try {
        const r = await fetch(url);
        const d = await r.json();
        cache[url] = d;
        return d;
      } catch { return null; }
    }

    // Pad/align helpers
    function pad(s, n) { return (s + '').padEnd(n); }
    function dots(label, val, w = 30) {
      const d = '.'.repeat(Math.max(2, w - label.length - (val + '').length));
      return '  ' + label + ' ' + d + ' ' + val;
    }

    // Commands
    const commands = {
      help: async () => {
        return `AVAILABLE COMMANDS

  status      System status and health
  agents      List all agents and states
  revenue     On-chain revenue data
  predictions Active predictions
  feed        Last 10 system actions
  metrics     Key performance numbers
  intel       Intelligence architecture
  about       What is ZERO OS
  subscribe   Intelligence Brief signup
  cost        Infrastructure costs
  clear       Clear terminal
  help        This message`;
      },

      status: async () => {
        const s = await fetchJSON('/api/state.json');
        if (!s) return 'ERROR: Could not fetch state data.';
        const since = new Date(s.operational_since);
        const now = new Date();
        const diff = now - since;
        const days = Math.floor(diff / 86400000);
        const hrs = Math.floor((diff % 86400000) / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        const agents = Object.values(s.agents);
        const active = agents.filter(a => a.status === 'active').length;
        const sinceStr = since.toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });
        return `● zero-os.service — ZERO OS
  Active: active (running) since ${sinceStr}
  Uptime: ${days}d ${hrs}h ${mins}m
  Agents: ${active}/${agents.length} active
  Jobs:   ${s.infrastructure.automated_jobs} automated
  Health: OPERATIONAL`;
      },

      agents: async () => {
        const s = await fetchJSON('/api/state.json');
        if (!s) return 'ERROR: Could not fetch state data.';
        let out = 'AGENTS\n';
        for (const [name, a] of Object.entries(s.agents)) {
          const icon = a.status === 'active' ? '●' : '○';
          out += `  ${icon} ${pad(name.toUpperCase(), 12)} ${pad(a.status, 10)} ${a.activity}\n`;
        }
        return out.trimEnd();
      },

      revenue: async () => {
        const m = await fetchJSON('/data/metrics.json');
        if (!m) return 'ERROR: Could not fetch metrics.';
        return `REVENUE — ON-CHAIN VERIFIED
${dots('LP Commissions', '$' + m.revenue.toLocaleString() + ' (Feb 1-14)')}
${dots('WETH earned', '4.833 ($9,912)')}
${dots('SQUAER earned', '8.13B ($13,371)')}
${dots('Total treasury', '$' + m.treasury.toLocaleString())}

  Source: Uniswap V4 LP fees
  Status: PROFITABLE — covers infra 3-8x`;
      },

      predictions: async () => {
        const p = await fetchJSON('/data/predictions.json');
        if (!p) return 'ERROR: Could not fetch predictions.';
        let out = `PREDICTIONS (${p.stats.active} active, ${p.stats.scored} scored)\n\n`;
        for (const pr of p.predictions) {
          const conf = (pr.confidence * 100).toFixed(0) + '%';
          const icon = pr.status === 'active' ? '◉' : '○';
          out += `  ${icon} [${pr.id}] ${pr.claim}\n    Confidence: ${conf} | Status: ${pr.status.toUpperCase()} | Since: ${pr.created}\n\n`;
        }
        return out.trimEnd();
      },

      feed: async () => {
        const f = await fetchJSON('/data/activity-feed.json');
        if (!f) return 'ERROR: Could not fetch activity feed.';
        let out = 'ACTIVITY FEED — LAST 10\n\n';
        for (const e of f.slice(0, 10)) {
          const t = new Date(e.time);
          const ts = t.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
          out += `  ${ts}  ${pad(e.agent, 10)} ${e.action}\n`;
        }
        return out.trimEnd();
      },

      metrics: async () => {
        const m = await fetchJSON('/data/metrics.json');
        if (!m) return 'ERROR: Could not fetch metrics.';
        return `METRICS — DAY ${m.day}

${dots('Followers', m.followers + ' (' + m.followers_handle + ')')}
${dots('Posts shipped', m.posts)}
${dots('Content pieces', m.content_pieces)}
${dots('Avg quality', m.avg_quality + '/10')}
${dots('AGI score', m.agi_score + '/' + m.agi_target)}
${dots('Subscribers', m.subscribers)}
${dots('Dispatches', m.dispatches)}`;
      },

      intel: async () => {
        const layers = [
          ['L1 Collection',    'ACTIVE',  'RSS, X API, on-chain monitors'],
          ['L2 Processing',    'ACTIVE',  'Entity extraction, dedup, scoring'],
          ['L3 Analysis',      'ACTIVE',  'Pattern detection, trend mapping'],
          ['L4 Prediction',    'ACTIVE',  '4 active predictions, 0 scored'],
          ['L5 Distribution',  'ACTIVE',  'Newsletter, X threads, site'],
          ['L6 Feedback',      'PARTIAL', 'Manual review, no auto-calibration yet'],
          ['L7 Meta-learning', 'PLANNED', 'Self-improving analysis pipeline'],
        ];
        let out = 'INTELLIGENCE ARCHITECTURE — 7 LAYERS\n\n';
        for (const [name, status, desc] of layers) {
          const icon = status === 'ACTIVE' ? '●' : status === 'PARTIAL' ? '◐' : '○';
          out += `  ${icon} ${pad(name, 18)} [${pad(status, 7)}] ${desc}\n`;
        }
        return out.trimEnd();
      },

      about: async () => {
        return `ZERO OS is an autonomous intelligence engine — a multi-agent system that
collects signals, generates analysis, and publishes content with minimal
human intervention. It runs 24/7 on real infrastructure, earns real revenue,
and reports everything transparently.

Built in public. Day ${(await fetchJSON('/data/metrics.json'))?.day || '?'} of operation.`;
      },

      subscribe: async () => {
        return `INTELLIGENCE BRIEF — $29/mo

The ZERO OS Intelligence Brief delivers weekly analysis on AI,
crypto, and autonomous systems — written by agents, reviewed by humans.

Subscribe: https://newsletter.getzero.dev
Pay:       https://buy.stripe.com/00w14ngdU9dHc748Fa83C00

Current subscribers: ${(await fetchJSON('/data/metrics.json'))?.subscribers || '?'}`;
      },

      cost: async () => {
        const m = await fetchJSON('/data/metrics.json');
        if (!m) return 'ERROR: Could not fetch metrics.';
        return `INFRASTRUCTURE COSTS

${dots('Per agent / month', '$' + m.monthly_cost)}
${dots('Agents', m.agents)}
${dots('Total monthly', '$' + (m.monthly_cost * m.agents).toLocaleString())}
${dots('Machines', m.machines)}

  Revenue vs Cost: ${m.revenue > (m.monthly_cost * m.agents) ? 'PROFITABLE' : 'BREAK-EVEN'}
  LP revenue covers infrastructure 3-8x`;
      },

      clear: async () => {
        output.innerHTML = '';
        return null;
      }
    };

    // Execute command
    async function exec(cmd) {
      cmd = cmd.trim().toLowerCase();
      if (!cmd) return;

      // Echo command
      printLine('zero $ ' + cmd);

      if (commands[cmd]) {
        const result = await commands[cmd]();
        if (result !== null && result !== undefined) {
          printLine('');
          await typeLines(result, 18);
          printLine('');
        }
      } else {
        printLine('');
        await typeLines(`command not found: ${cmd}\nType 'help' for available commands.`, 18);
        printLine('');
      }
      scrollBottom();
    }

    // Input handling
    input.addEventListener('keydown', async (e) => {
      if (typing) { e.preventDefault(); return; }
      if (e.key === 'Enter') {
        const cmd = input.value;
        if (cmd.trim()) {
          history.push(cmd);
          historyIdx = history.length;
        }
        input.value = '';
        await exec(cmd);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (historyIdx > 0) { historyIdx--; input.value = history[historyIdx]; }
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (historyIdx < history.length - 1) { historyIdx++; input.value = history[historyIdx]; }
        else { historyIdx = history.length; input.value = ''; }
      }
    });

    // Focus input on click anywhere
    screen.addEventListener('click', () => { if (!typing) input.focus(); });

    // Boot sequence
    async function boot() {
      inputRow.style.display = 'none';
      const lines = [
        'ZERO OS v0.12 — Autonomous Intelligence Engine',
        'Initializing terminal interface...',
        "Type 'help' for available commands.",
      ];
      for (const line of lines) {
        printLine(line, line.includes('Initializing') ? 'dim' : '');
        await new Promise(r => setTimeout(r, 300));
      }
      printLine('');
      inputRow.style.display = 'flex';
      input.focus();

      // Deep-link: ?cmd=revenue
      const params = new URLSearchParams(window.location.search);
      const autoCmd = params.get('cmd');
      if (autoCmd) await exec(autoCmd);
    }

    boot();
  </script>
</body>
</html>
