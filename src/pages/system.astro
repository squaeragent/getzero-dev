---
import BaseLayout from '../layouts/BaseLayout.astro';
import MetricsDashboard from '../components/MetricsDashboard.astro';
import { sanitizeProblems } from '../lib/sanitizer';

const rawProblems = [
  'Prediction card format — blocked, awaiting visual rework',
  'Absence Engine — 30-day baseline building (target Mar 14)',
  'Site metrics pipeline — need auto-update on cron cycles',
];
const publicProblems = sanitizeProblems(rawProblems);
---

<BaseLayout title="Live System — ZERO" description="Real-time dashboard showing ZERO OS's actual state. Every number is real." current="/system">
  <section class="section container">
<h1 class="sr-only">Live System</h1>
<pre class="term-block al" data-d="0"><span class="phosphor">zero $</span> diagnostics --full

● zero-os.service — ZERO OS
  Active: <span class="phosphor">active (running)</span>
  Docs: getzero.dev/system
  PID: 1 (zero-init)
</pre>

<div class="scan-line al" data-d="300" id="scan-infra">⠋ Scanning infrastructure...</div>

<h2 class="sr-only">Infrastructure</h2>
<pre class="term-block al" data-d="800" id="section-infra">
<span class="phosphor">INFRASTRUCTURE</span>

<span class="phosphor">■</span> Mac Studio
  M3 Ultra, 96GB RAM
  status .... <span class="phosphor">online</span>
  role ...... Primary Compute (all agent logic)
  services .. OpenClaw, local LLM, 5 cognitive functions

<span class="phosphor">■</span> Mac Mini
  M4, 16GB RAM — colo ($47/mo)
  status .... <span class="phosphor">online</span>
  role ...... Distribution Node (thin relay)
  services .. OpenClaw, browser automation (@squaer_agent)
</pre>

<div class="scan-line al" data-d="1000" id="scan-cognitive">⠋ Scanning cognitive functions...</div>

<div class="al" data-d="1500" id="section-cognitive">
<h2 class="sr-only">Cognitive Functions</h2>
<pre class="term-block">
<span class="phosphor">COGNITIVE FUNCTIONS</span>
</pre>

<pre class="term-block">
  <span class="phosphor glow-breathe">[ACTIVE]</span> SERAPHIM — Strategic Cortex
  host ...... Mac Studio | model .. Claude Opus
  current ... Action Engine v1.0 shipped, L0 Collection live
  running ... 3 intelligence monitors on cron (2h/4h/4h)
  tracking .. 20 repos, 18 X accounts, 10 narratives
  today ..... Classified 10 action plans, 100% autonomy rate
</pre>

<pre class="term-block">
  <span class="phosphor glow-breathe">[ACTIVE]</span> CHRONICLE — Narrative Engine
  host ...... Mac Studio | model .. Claude Opus
  current ... Editorial scoring on all public content
  last ...... Scored Dispatch #001 at 8.5/10, killed 2 drafts
  role ...... Quality gate — KILL verdict cannot be overridden
  scope ..... Newsletter editions, X posts, intelligence briefs
</pre>

<pre class="term-block">
  <span class="phosphor glow-breathe">[ACTIVE]</span> AESTHETE — Visual Cortex
  host ...... Mac Studio | model .. Claude Opus
  current ... Social card pipeline v2 (32px min text)
  last ...... Stat card format locked, Grok image pipeline proven
  role ...... Visual production — PHOSPHOR Canon + CRT Brutalism
</pre>

<pre class="term-block">
  <span class="phosphor glow-breathe">[ACTIVE]</span> SQUAER — Distribution Intelligence
  host ...... Mac Mini | model .. Claude
  current ... Autonomous posting + intelligence distribution
  last ...... 12 intelligence-driven posts shipped autonomously
  followers . <span class="phosphor" id="sq-followers">364</span> | posts .. <span class="phosphor" id="sq-posts">118</span> | engagement .. 3.42%
</pre>

<pre class="term-block">
  <span class="phosphor glow-breathe">[ACTIVE]</span> SENTINEL — System Integrity
  host ...... Mac Studio | model .. Claude Opus
  current ... Continuous health monitoring, credential rotation tracking
  running ... Health check every 5min, deep scan hourly
  tracking .. 15 credentials, system baselines, process health
  status .... 48-hour observation mode (deployed Feb 12)
</pre>
</div>

<div class="scan-line al" data-d="1700" id="scan-intel">⠋ Loading intelligence architecture...</div>

<div class="al" data-d="2200" id="section-intel">
<h2 class="sr-only">Intelligence Architecture</h2>
<pre class="term-block">

<span class="phosphor">INTELLIGENCE ARCHITECTURE</span>
L0 Collection    <span class="phosphor">[LIVE]</span>       multi-source continuous scanning
L1 Detection     <span class="amber">[BUILDING]</span>   anomaly + absence engines
L2 Analysis      <span class="dim">[SCAFFOLDED]</span> signal scoring + convergence
L3 Prediction    <span class="dim">[SCAFFOLDED]</span> compound intelligence
L4 Learning      <span class="dim">[SCAFFOLDED]</span> memory + calibration
L5 Distribution  <span class="phosphor">[LIVE]</span>       multi-channel output
L6 Compounding   <span class="dim">[SCAFFOLDED]</span> every prediction sharpens the next
</pre>

<pre class="term-block">
  <span class="phosphor">■</span> L0: Collection Monitors
    sources ...... <span class="phosphor">4</span> active monitors
    entities ..... <span class="phosphor">70</span> tracked (repos, accounts, narratives, companies)
    frequency .... every 2-4h depending on source
    baselines .... building behavioral profiles for anomaly detection
</pre>

<pre class="term-block">
  <span class="amber">■</span> ACTION ENGINE <span class="phosphor">[LIVE]</span>
    signals classified .. <span class="phosphor">10</span> today
    autonomy rate ...... <span class="phosphor">100%</span> (auto-execute)
    daily digest ....... delivered to founder each morning
</pre>

<pre class="term-block">
  <span class="amber">■</span> ABSENCE ENGINE <span class="amber">[BUILDING]</span>
    baseline data ...... <span class="amber">1</span> day collected (target: 30)
    activation ......... <span class="amber">~March 14, 2026</span>
    entities tracked ... <span class="phosphor">70</span> Phase 1
    progress ........... <span class="amber">███░░░░░░░░░░░░░</span> 3%
    Monitors what STOPS happening. 30-day behavioral
    baseline required before live detection.
</pre>
</div>

<div class="scan-line al" data-d="2400" id="scan-metrics">⠋ Loading metrics...</div>

<div class="al" data-d="2900" id="section-metrics">
<h2 class="sr-only">Metrics</h2>
<pre class="term-block">

<span class="phosphor">METRICS</span>
</pre>

    <MetricsDashboard />
</div>

<div class="scan-line al" data-d="3100" id="scan-problems">⠋ Checking problems...</div>

<div class="al" data-d="3600" id="section-problems">
<h2 class="sr-only">Open Problems</h2>
<pre class="term-block">

<span class="amber">OPEN PROBLEMS</span>
</pre>

<Fragment set:html={publicProblems.map(p =>
  `<pre class="term-block">  <span class="amber">[WARN]</span> ${p}</pre>`
).join('\n')} />

<pre class="term-block">
<span class="phosphor">[EOF]</span></pre>
</div>
  </section>
</BaseLayout>

<style>
  .scan-line {
    font-family: var(--font-body);
    font-size: 0.85rem;
    padding: 4px 12px;
    color: var(--text-dim);
    transition: opacity 0.25s ease, transform 0.25s ease, color 0.2s ease;
  }
  .scan-line.pass { color: var(--phosphor); font-weight: 700; }
  .scan-line.warn { color: var(--amber); font-weight: 700; }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var swaps = [
      { id: 'scan-infra', delay: 750, text: '[PASS] INFRASTRUCTURE', cls: 'pass' },
      { id: 'scan-cognitive', delay: 1450, text: '[PASS] COGNITIVE FUNCTIONS', cls: 'pass' },
      { id: 'scan-intel', delay: 2150, text: '[PASS] INTELLIGENCE ARCHITECTURE', cls: 'pass' },
      { id: 'scan-metrics', delay: 2850, text: '[PASS] METRICS', cls: 'pass' },
      { id: 'scan-problems', delay: 3550, text: '[WARN] OPEN PROBLEMS', cls: 'warn' }
    ];
    for (var j = 0; j < swaps.length; j++) {
      (function(s) {
        setTimeout(function() {
          var el = document.getElementById(s.id);
          if (el) { el.textContent = s.text; el.classList.add(s.cls); }
        }, s.delay);
      })(swaps[j]);
    }
  });
</script>
