---
import BaseLayout from '../layouts/BaseLayout.astro';
import MetricsDashboard from '../components/MetricsDashboard.astro';
import { system, infrastructure, functions, problems } from '../data/metrics';
---

<BaseLayout title="Live System — ZERO" description="Real-time dashboard showing ZERO OS's actual state. Every number is real." current="/system">
  <section class="section container">
<h1 class="sr-only">Live System</h1>
<pre class="term-block al" data-d="0"><span class="phosphor">zero $</span> diagnostics --full

● zero-os.service — ZERO OS
  Active: <span class="phosphor">active (running)</span>
  Docs: getzero.dev/system
  PID: 1 (zero-init)
</pre>

<div class="scan-line al" data-d="300" id="scan-infra">⠋ Scanning infrastructure...</div>

<h2 class="sr-only">Infrastructure</h2>
<pre class="term-block al" data-d="800" id="section-infra">
<span class="phosphor">INFRASTRUCTURE</span>
════════════════════════════════════

<span class="phosphor">■</span> Mac Studio
  {system.mac_studio || 'M3 Ultra, 96GB RAM'}
  status .... <span class="phosphor">{infrastructure.mac_studio?.status || 'online'}</span>
  disk ...... {infrastructure.mac_studio?.disk_used_pct || 2}% used
  services .. OpenClaw, Ollama

<span class="phosphor">■</span> Mac Mini
  {system.mac_mini || 'M4, 16GB RAM — colo'}
  status .... <span class="phosphor">{infrastructure.mac_mini?.status || 'online'}</span>
  role ...... {infrastructure.mac_mini?.role || 'Distribution Node'}
  services .. OpenClaw, Chrome CDP
</pre>

<div class="scan-line al" data-d="1000" id="scan-cognitive">⠋ Scanning cognitive functions...</div>

<div class="al" data-d="1500" id="section-cognitive">
<h2 class="sr-only">Cognitive Functions</h2>
<pre class="term-block">
<span class="phosphor">COGNITIVE FUNCTIONS</span>
════════════════════════════════════
</pre>

{Object.entries(functions).map(([name, data]: [string, any]) => (
<pre class="term-block">
  <span class="phosphor">[ACTIVE]</span> {name.toUpperCase()}
  {data.role}
  model ..... {data.model}
  brain ..... {data.brain_complete ? '██████████ complete' : '████░░░░░░ incomplete'}
</pre>
))}
</div>

<div class="scan-line al" data-d="1700" id="scan-metrics">⠋ Loading metrics...</div>

<div class="al" data-d="2200" id="section-metrics">
<h2 class="sr-only">Metrics</h2>
<pre class="term-block">

<span class="phosphor">METRICS</span>
════════════════════════════════════
</pre>

    <MetricsDashboard />
</div>

<div class="scan-line al" data-d="2400" id="scan-problems">⠋ Checking problems...</div>

<div class="al" data-d="2900" id="section-problems">
<h2 class="sr-only">Open Problems</h2>
<pre class="term-block">

<span class="amber">OPEN PROBLEMS</span>
════════════════════════════════════
</pre>

{problems.critical?.map((p: string) => (
<pre class="term-block">  <span class="amber">[CRIT]</span> {p}</pre>
))}
{problems.high?.map((p: string) => (
<pre class="term-block">  <span class="amber">[HIGH]</span> {p}</pre>
))}
{problems.medium?.map((p: string) => (
<pre class="term-block">  [MED ] {p}</pre>
))}

<pre class="term-block">
<span class="phosphor">[EOF]</span></pre>
</div>
  </section>
</BaseLayout>

<style>
  .scan-line {
    font-family: var(--font-body);
    font-size: 0.85rem;
    padding: 4px 12px;
    color: var(--text-dim);
    transition: opacity 0.25s ease, transform 0.25s ease, color 0.2s ease;
  }
  .scan-line.pass { color: var(--phosphor); font-weight: 700; }
  .scan-line.warn { color: var(--amber); font-weight: 700; }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var swaps = [
      { id: 'scan-infra', delay: 750, text: '[PASS] INFRASTRUCTURE', cls: 'pass' },
      { id: 'scan-cognitive', delay: 1450, text: '[PASS] COGNITIVE FUNCTIONS', cls: 'pass' },
      { id: 'scan-metrics', delay: 2150, text: '[PASS] METRICS', cls: 'pass' },
      { id: 'scan-problems', delay: 2850, text: '[WARN] OPEN PROBLEMS', cls: 'warn' }
    ];
    for (var j = 0; j < swaps.length; j++) {
      (function(s) {
        setTimeout(function() {
          var el = document.getElementById(s.id);
          if (el) { el.textContent = s.text; el.classList.add(s.cls); }
        }, s.delay);
      })(swaps[j]);
    }
  });
</script>
