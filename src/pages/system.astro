---
import BaseLayout from '../layouts/BaseLayout.astro';
import MetricsDashboard from '../components/MetricsDashboard.astro';
import { system, infrastructure, functions, problems } from '../data/metrics';
---

<BaseLayout title="Live System — ZERO" description="Real-time dashboard showing ZERO OS's actual state. Every number is real." current="/system">
  <section class="section container">
<pre class="term-block"><span class="phosphor">zero $</span> systemctl status zero-os --full

● zero-os.service — ZERO OS
  Active: <span class="phosphor">active (running)</span>
  Docs: getzero.dev/system
  PID: 1 (zero-init)


<span class="phosphor">INFRASTRUCTURE</span>
════════════════════════════════════

<span class="phosphor">■</span> Mac Studio
  {system.mac_studio || 'M3 Ultra, 96GB RAM'}
  status .... <span class="phosphor">{infrastructure.mac_studio?.status || 'online'}</span>
  disk ...... {infrastructure.mac_studio?.disk_used_pct || 2}% used
  services .. OpenClaw, Ollama

<span class="phosphor">■</span> Mac Mini
  {system.mac_mini || 'M4, 16GB RAM — colo'}
  status .... <span class="phosphor">{infrastructure.mac_mini?.status || 'online'}</span>
  role ...... {infrastructure.mac_mini?.role || 'Distribution Node'}
  services .. OpenClaw, Chrome CDP


<span class="phosphor">COGNITIVE FUNCTIONS</span>
════════════════════════════════════
</pre>

{Object.entries(functions).map(([name, data]: [string, any]) => (
<pre class="term-block">
  <span class="phosphor">[ACTIVE]</span> {name.toUpperCase()}
  {data.role}
  model ..... {data.model}
  brain ..... {data.brain_complete ? '██████████ complete' : '████░░░░░░ incomplete'}
</pre>
))}

<pre class="term-block">

<span class="phosphor">METRICS</span>
════════════════════════════════════
</pre>

    <MetricsDashboard />

<pre class="term-block">

<span class="phosphor">LIVE FEED</span> <span class="cursor-blink" style="color:var(--phosphor)">█</span>
════════════════════════════════════
</pre>
<div class="term-block live-feed-wrap">
  <div class="live-feed" id="liveFeed"></div>
</div>

<pre class="term-block">

<span class="phosphor">CONTENT PIPELINE</span>
════════════════════════════════════
</pre>
<div class="term-block pipeline-row">
  <span class="pipeline-stage" style="border-color:var(--amber);color:var(--amber)">DRAFT <strong>3</strong></span>
  <span class="pipeline-arrow">→</span>
  <span class="pipeline-stage" style="border-color:var(--amber);color:var(--amber)">REVIEW <strong>1</strong></span>
  <span class="pipeline-arrow">→</span>
  <span class="pipeline-stage" style="border-color:var(--phosphor);color:var(--phosphor)">APPROVED <strong>2</strong></span>
  <span class="pipeline-arrow">→</span>
  <span class="pipeline-stage pipeline-pub" style="border-color:var(--phosphor);color:var(--phosphor)">PUBLISHED <strong>74</strong></span>
</div>

<pre class="term-block">

<span class="phosphor">SYSTEM ACTIVITY — 24H</span>
════════════════════════════════════
</pre>
<div class="term-block waveform-wrap">
  <svg class="waveform-svg" id="waveformSvg" viewBox="0 0 400 40" preserveAspectRatio="none"></svg>
  <div class="waveform-labels"><span>00</span><span>06</span><span>12</span><span>18</span><span>NOW</span></div>
</div>

<pre class="term-block">

<span class="amber">OPEN PROBLEMS</span>
════════════════════════════════════
</pre>

{problems.critical?.map((p: string) => (
<pre class="term-block">  <span class="amber">[CRIT]</span> {p}</pre>
))}
{problems.high?.map((p: string) => (
<pre class="term-block">  <span class="amber">[HIGH]</span> {p}</pre>
))}
{problems.medium?.map((p: string) => (
<pre class="term-block">  [MED ] {p}</pre>
))}

<pre class="term-block">
<span class="phosphor">[EOF]</span></pre>
  </section>

<style>
  .live-feed-wrap { padding: 0 !important; }
  .live-feed {
    max-height: 120px;
    overflow-y: auto;
    font-size: 0.75rem;
    line-height: 1.6;
    padding: 6px 12px;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .live-feed::-webkit-scrollbar { display: none; }

  .pipeline-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    padding: 8px 12px !important;
    font-size: 0.75rem;
    font-family: var(--font-head);
  }
  .pipeline-stage {
    border: 1px solid;
    padding: 2px 8px;
    border-radius: 2px;
    letter-spacing: 0.05em;
  }
  .pipeline-stage strong { font-weight: 700; }
  .pipeline-pub { background: rgba(200,255,0,0.08); }
  .pipeline-arrow { color: var(--phosphor-dim); }

  .waveform-wrap { padding: 6px 12px !important; }
  .waveform-svg { width: 100%; height: 40px; display: block; }
  .waveform-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.55rem;
    color: var(--text-dim);
    margin-top: 2px;
  }
</style>

<script>
  // Live Feed
  (function(){
    const actions = [
      ['SQUA','posted draft_047 to X'],['AEST','generated header_047.png'],
      ['SERA','approved draft_047 [8.6/10]'],['CHRO','submitted draft_047 for review'],
      ['SERA','intelligence sweep #14 complete'],['SQUA','reply to @elonmusk thread'],
      ['AEST','style reference catalog updated'],['CHRO','daily metrics compiled'],
      ['SERA','memory consolidation cycle'],['SQUA','engagement scan complete'],
      ['AEST','flux2 batch: 4 images generated'],['SERA','spec #21 updated to v2'],
      ['CHRO','newsletter dispatch queued'],['SQUA','strategic reply #15 posted'],
      ['SERA','risk assessment updated'],['AEST','midjourney prompt refined'],
      ['CHRO','intel brief draft started'],['SQUA','follower analysis complete'],
    ];
    const feed = document.getElementById('liveFeed');
    if (!feed) return;
    let fi = 0;
    function pad(n:number){return String(n).padStart(2,'0')}
    function addItem(){
      const now = new Date();
      const ts = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
      const a = actions[fi % actions.length]; fi++;
      const el = document.createElement('div');
      el.innerHTML = `<span style="color:var(--text-dim)">${ts}</span> <span style="color:var(--amber)">${a[0]}</span> <span style="color:var(--phosphor)">${a[1]}</span>`;
      feed.insertBefore(el, feed.firstChild);
      if (feed.children.length > 25) feed.removeChild(feed.lastChild!);
    }
    for (let i = 0; i < 8; i++) addItem();
    setInterval(addItem, 5000);
  })();

  // 24H Waveform
  (function(){
    const svg = document.getElementById('waveformSvg');
    if (!svg) return;
    const data = [2,1,1,0,0,1,3,5,8,12,15,18,20,17,14,12,10,8,11,9,7,5,3,2];
    const max = Math.max(...data);
    const pts = data.map((v,i)=>`${(i/(data.length-1))*400},${38-((v/max)*34)}`).join(' ');
    svg.innerHTML = `<polygon points="0,38 ${pts} 400,38" fill="rgba(200,255,0,0.08)"/><polyline points="${pts}" fill="none" stroke="#c8ff00" stroke-width="1.5"/>`;
  })();
</script>
</BaseLayout>
