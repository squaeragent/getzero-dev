---
export const prerender = true;
import BaseLayout from '../layouts/BaseLayout.astro';
import BriefCTA from '../components/BriefCTA.astro';
import fs from 'node:fs';
import path from 'node:path';

// Load from single source of truth
let rawPredictions: any[] = [];
try {
  const dataPath = path.join(process.cwd(), 'public', 'data', 'predictions.json');
  const data = JSON.parse(fs.readFileSync(dataPath, 'utf-8'));
  rawPredictions = data.predictions || [];
} catch {}

// Map to page format
const predictions = rawPredictions.map((p: any) => ({
  id: p.id,
  title: p.claim,
  deadline: p.deadline || p.created,
  confidence: p.confidence >= 0.7 ? 'HIGH' : p.confidence >= 0.4 ? 'MED' : 'LOW',
  status: p.status === 'active' ? 'PENDING' : p.status === 'correct' ? 'CORRECT' : p.status === 'wrong' ? 'WRONG' : 'PENDING',
  source: p.source || 'Intelligence Brief',
}));

const total = predictions.length;
const correct = predictions.filter(p => p.status === 'CORRECT').length;
const wrong = predictions.filter(p => p.status === 'WRONG').length;
const resolved = correct + wrong;

function statusClass(s: string) {
  if (s === 'CORRECT') return 'phosphor';
  if (s === 'WRONG') return 'amber';
  return 'dim';
}
---

<BaseLayout title="Prediction Tracker — ZERO" description="Public predictions from ZERO Intelligence Briefs. Tracked, scored, accountable." current="/predictions" ogImage="/og/predictions.png">
  <h1 class="sr-only">Prediction Tracker</h1>
  <pre class="term-block"><span class="phosphor">zero $</span> zero-intel --predictions --track

<span class="phosphor">PREDICTION TRACKER</span>

accuracy .. <span class="phosphor">{resolved > 0 ? `${Math.round((correct/resolved)*100)}%` : 'N/A'}</span>
resolved .. {resolved}/{total}
pending ... {total - resolved}
<span class="dim">(first edition — baseline)</span>
</pre>
<Fragment set:html={predictions.map(p => `<pre class="term-block">
<span class="phosphor">${p.id}</span> <span class="${statusClass(p.status)}">[${p.status}]</span>
${p.title}

deadline ... ${p.deadline}
confidence . ${p.confidence}
<span class="dim">src: ${p.source}</span>
</pre>`).join('\n')} />
<pre class="term-block">
<span class="dim">No quiet deletions. No retroactive edits.</span>

<span class="amber">zero $</span> subscribe --intel-brief
→ <a href="https://newsletter.getzero.dev/upgrade"><span class="amber">newsletter.getzero.dev/upgrade</span></a>
<span class="dim">$29/mo — full signal analysis</span>

<span class="phosphor">zero $</span> <span class="terminal-cursor">█</span></pre>
<BriefCTA />
</BaseLayout>
