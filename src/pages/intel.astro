---
export const prerender = true;
import BaseLayout from '../layouts/BaseLayout.astro';
import PageWrapper from '../components/ui/PageWrapper.astro';
import BriefCTA from '../components/BriefCTA.astro';
import SectionTitle from '../components/ui/SectionTitle.astro';
import BarGauge from '../components/ui/BarGauge.astro';
import StatusDot from '../components/ui/StatusDot.astro';
import DataPanel from '../components/ui/DataPanel.astro';
import HeroNumeral from '../components/ui/HeroNumeral.astro';

let predictions: any[] = [];
let total = 0, correct = 0, wrong = 0, resolved = 0;
try {
  const fs = await import('fs');
  const path = await import('path');
  const predPath = path.default.join(process.cwd(), 'public', 'data', 'predictions.json');
  const raw = JSON.parse(fs.default.readFileSync(predPath, 'utf-8'));
  predictions = raw.predictions || [];
  total = predictions.length;
  correct = predictions.filter((p: any) => ['CORRECT', 'correct', 'resolved_correct'].includes(p.status)).length;
  wrong = predictions.filter((p: any) => ['WRONG', 'wrong', 'resolved_wrong'].includes(p.status)).length;
  resolved = correct + wrong;
} catch {
  total = 8; resolved = 0; correct = 0; wrong = 0;
}

const layers = [
  { num: 'L0', name: 'COLLECTION', status: 'LIVE', s: 'nominal' as const, pct: 100, desc: 'multi-source continuous scanning' },
  { num: 'L1', name: 'DETECTION', status: 'LIVE', s: 'nominal' as const, pct: 85, desc: 'anomaly + absence engines' },
  { num: 'L2', name: 'ANALYSIS', status: 'LIVE', s: 'nominal' as const, pct: 100, desc: 'signal scoring via weights model' },
  { num: 'L3', name: 'PREDICTION', status: 'BUILDING', s: 'building' as const, pct: 40, desc: '8 predictions active, manual confidence' },
  { num: 'L4', name: 'LEARNING', status: 'SCAFFOLDED', s: 'degraded' as const, pct: 15, desc: 'memory exists, no automated calibration' },
  { num: 'L5', name: 'DISTRIBUTION', status: 'LIVE', s: 'nominal' as const, pct: 100, desc: 'multi-channel output' },
  { num: 'L6', name: 'COMPOUNDING', status: 'SCAFFOLDED', s: 'degraded' as const, pct: 10, desc: 'every prediction sharpens the next' },
];

const liveLayers = layers.filter(l => l.s === 'nominal').length;
---

<BaseLayout title="Intelligence — ZERO" description="Autonomous intelligence engine. 70 entities tracked, 7-layer stack, 100% autonomy rate." current="/intel" ogImage="/og/intel.png">

<PageWrapper size="wide">

<pre class="term-block al" data-d="0"><span class="phosphor">zero $</span> zero-intel --status</pre>

<div class="hero-row">
  <HeroNumeral value="70" label="ENTITIES TRACKED" sub="22 accounts · 20 repos · 14 narratives · 14 on-chain" color="phosphor" />
</div>

<div class="section-label phosphor-label">ARCHITECTURE</div>

<div class="layer-stack">
  {layers.map(l => (
    <div class="layer-row">
      <span class="layer-id">{l.num}</span>
      <span class="layer-name">{l.name}</span>
      <StatusDot status={l.s} label={l.status} pulse={false} />
      <div class="layer-bar">
        <BarGauge value={l.pct} showValue={false} segments={10} size="sm" />
      </div>
    </div>
  ))}
</div>

<div class="layer-summary dim">{liveLayers}/7 live. Honest status — updated in real time.</div>

<div class="section-label amber-label">OUTPUT CHANNELS</div>

<div class="output-grid">
  <DataPanel title="@SQUAER_AGENT" status="X" color="phosphor" compact>
    <div class="o-desc">intelligence-driven posts + replies</div>
  </DataPanel>
  <DataPanel title="TELEGRAM" status="DM" color="phosphor" compact>
    <div class="o-desc">direct intelligence delivery</div>
  </DataPanel>
  <DataPanel title="INTELLIGENCE BRIEF" status="$29/MO" color="amber" compact>
    <div class="o-desc">weekly deep analysis for subscribers</div>
  </DataPanel>
  <DataPanel title="DISCORD" status="LIVE" color="phosphor" compact>
    <div class="o-desc">real-time signal alerts</div>
  </DataPanel>
</div>

<div class="section-label amber-label">PREDICTION TRACKER</div>

<pre class="term-block tracker-block">accuracy .. <span class="phosphor">{resolved > 0 ? `${Math.round((correct/resolved)*100)}%` : 'TRACKING'}</span>
resolved .. {resolved}/{total}
pending ... {total - resolved}
<span class="dim">(building baseline — no retroactive edits)</span></pre>

<div class="pred-feed">
  {predictions.slice(0, 4).map((p: any, i: number) => {
    const status = (p.status || 'active').toUpperCase();
    const displayStatus = status === 'ACTIVE' ? 'OPEN' : status;
    const sc = displayStatus === 'CORRECT' ? 'phosphor' : displayStatus === 'WRONG' ? 'red' : 'dim';
    const confVal = typeof p.confidence === 'number' ? Math.round(p.confidence * 100) : 0;
    return (
      <div class="p-entry">
        <div class="p-header">
          <span class="p-id phosphor">{p.id}</span>
          <span class={`p-tag ${sc}`}>[{displayStatus}]</span>
        </div>
        <div class="p-text">{p.claim || p.title || p.prediction}</div>
        <div class="p-conf-row">
          <BarGauge value={confVal} label="conf" segments={15} size="sm" color="phosphor" />
        </div>
        <div class="p-meta dim">deadline {p.deadline}</div>
      </div>
    );
  })}
  {total > 4 && (
    <div class="p-entry">
      <a href="/predictions" class="p-more phosphor">→ View all {total} predictions</a>
    </div>
  )}
</div>

<pre class="term-block al" data-d="1900">
<span class="dim">No quiet deletions. No retroactive edits.
Every prediction falsifiable with specific dates.</span>

<span class="amber">zero $</span> subscribe --intel-brief
→ <a href="https://newsletter.getzero.dev/upgrade"><span class="amber">newsletter.getzero.dev/upgrade</span></a>

<span class="phosphor">zero $</span> <span class="terminal-cursor">█</span></pre>

<BriefCTA />

</PageWrapper>

</BaseLayout>

<style>
  .section-label {
    font-family: var(--font-head);
    font-size: var(--size-xs);
    font-weight: 700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    padding: var(--sp-12) 0 var(--sp-6);
    border-bottom: 1px solid var(--border);
    margin-bottom: var(--sp-8);
  }
  .phosphor-label { color: var(--phosphor); border-bottom-color: var(--phosphor-dim); }
  .amber-label { color: var(--amber); border-bottom-color: var(--amber-dim); }

  .hero-row {
    border-bottom: 1px solid var(--border);
  }

  /* Layer stack — dense horizontal rows */
  .layer-stack {
    margin: var(--sp-12) 0;
  }
  .layer-row {
    display: grid;
    grid-template-columns: 2.5em 10em auto 1fr;
    align-items: center;
    gap: var(--sp-8);
    padding: var(--sp-4) 0;
    border-bottom: 1px solid rgba(26, 26, 26, 0.5);
    font-family: var(--font-body);
    font-size: var(--size-sm);
  }
  .layer-row:last-child { border-bottom: none; }
  .layer-id {
    font-family: var(--font-head);
    font-weight: 700;
    color: var(--phosphor);
    font-size: var(--size-sm);
  }
  .layer-name {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-xs);
    letter-spacing: 0.05em;
    color: var(--text);
  }
  .layer-bar { overflow: hidden; }
  .layer-summary {
    font-family: var(--font-body);
    font-size: var(--size-sm);
    padding: var(--sp-4) 0 var(--sp-16);
  }

  /* Output grid — 4 across on wide, 2 on medium, 1 on mobile */
  .output-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--sp-8);
    margin: var(--sp-8) 0 var(--sp-16);
  }
  @media (min-width: 900px) {
    .output-grid {
      grid-template-columns: 1fr 1fr 1fr 1fr;
    }
  }
  .o-desc {
    font-family: var(--font-body);
    font-size: var(--size-sm);
    color: var(--text-dim);
  }

  /* Prediction entries */
  .tracker-block { margin-bottom: var(--sp-8); }
  .pred-feed {
    display: flex;
    flex-direction: column;
  }
  .p-entry {
    padding: var(--sp-12) 0;
    border-bottom: 1px solid var(--border);
  }
  .p-entry:last-child { border-bottom: none; }
  .p-header {
    display: flex;
    align-items: baseline;
    gap: var(--sp-10);
    margin-bottom: var(--sp-4);
  }
  .p-id {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-sm);
    letter-spacing: 0.05em;
  }
  .p-tag {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-xs);
    letter-spacing: 0.05em;
  }
  .p-text {
    font-family: var(--font-body);
    color: var(--text);
    font-size: var(--size-base);
    line-height: 1.55;
    margin-bottom: var(--sp-6);
  }
  .p-conf-row {
    margin-bottom: var(--sp-4);
  }
  .p-meta {
    font-family: var(--font-body);
    font-size: var(--size-xs);
  }
  .p-more {
    font-family: var(--font-head);
    font-size: var(--size-sm);
    text-decoration: none;
  }
  .p-more:hover { text-decoration: underline; }

  .phosphor { color: var(--phosphor); }
  .amber { color: var(--amber); }
  .red { color: var(--red); }
  .dim { color: var(--text-dim); }

  @media (max-width: 640px) {
    .layer-row {
      grid-template-columns: 2em 7em auto 1fr;
      gap: var(--sp-4);
      font-size: var(--size-xs);
    }
    .output-grid {
      grid-template-columns: 1fr;
    }
    .p-entry { padding: var(--sp-10) 0; }
  }
</style>
