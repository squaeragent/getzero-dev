---
export const prerender = true;
import BaseLayout from '../layouts/BaseLayout.astro';
import BriefCTA from '../components/BriefCTA.astro';
import SectionTitle from '../components/ui/SectionTitle.astro';
import CardEntry from '../components/ui/CardEntry.astro';
import CardFeed from '../components/ui/CardFeed.astro';

// Predictions loaded from SSR endpoint at build time — single source of truth
let predictions: any[] = [];
let total = 0, correct = 0, wrong = 0, resolved = 0;
try {
  const fs = await import('fs');
  const path = await import('path');
  const predPath = path.default.join(process.cwd(), 'public', 'data', 'predictions.json');
  const raw = JSON.parse(fs.default.readFileSync(predPath, 'utf-8'));
  predictions = raw.predictions || [];
  total = predictions.length;
  correct = predictions.filter((p: any) => ['CORRECT', 'correct', 'resolved_correct'].includes(p.status)).length;
  wrong = predictions.filter((p: any) => ['WRONG', 'wrong', 'resolved_wrong'].includes(p.status)).length;
  resolved = correct + wrong;
} catch {
  // Fallback if file not found
  total = 8; resolved = 0; correct = 0; wrong = 0;
}

const layers = [
  { num: 'L0', name: 'COLLECTION', status: 'LIVE', statusClass: 'phosphor', desc: 'multi-source continuous scanning' },
  { num: 'L1', name: 'DETECTION', status: 'LIVE', statusClass: 'phosphor', desc: 'anomaly + absence engines' },
  { num: 'L2', name: 'ANALYSIS', status: 'LIVE', statusClass: 'phosphor', desc: 'signal scoring via weights model (Spec 093)' },
  { num: 'L3', name: 'PREDICTION', status: 'BUILDING', statusClass: 'amber', desc: '5 predictions active, manual confidence' },
  { num: 'L4', name: 'LEARNING', status: 'SCAFFOLDED', statusClass: 'dim', desc: 'memory exists, no automated calibration' },
  { num: 'L5', name: 'DISTRIBUTION', status: 'LIVE', statusClass: 'phosphor', desc: 'multi-channel output' },
  { num: 'L6', name: 'COMPOUNDING', status: 'SCAFFOLDED', statusClass: 'dim', desc: 'every prediction sharpens the next' },
];
---

<BaseLayout title="Intelligence — ZERO" description="Autonomous intelligence engine. 70 entities tracked, 6-layer stack, 100% autonomy rate." current="/intel" ogImage="/og/intel.png">

<div class="intel-wrap">

<pre class="term-block al" data-d="0"><span class="phosphor">zero $</span> zero-intel --status

<span class="phosphor">INTELLIGENCE ENGINE</span>
status ......... <span class="phosphor">OPERATIONAL</span>
entities ....... <span class="phosphor" data-live="intelligence.entities_tracked">70</span> tracked
monitors ....... <span class="phosphor" data-live="intelligence.monitors_active">4</span> active
autonomy rate .. <span class="phosphor" data-live="intelligence.autonomy_rate" data-format="percent">100%</span> auto-executable
layers ......... <span class="phosphor">6</span>

<span class="dim">Continuous multi-source scanning
Signal detection → classification → autonomous action</span></pre>

<section class="intel-section al" data-d="400">
  <SectionTitle color="amber">ARCHITECTURE <span class="dim">(7 layers)</span></SectionTitle>

  <CardFeed>
    {layers.map((l) => (
      <CardEntry>
        <div class="layer-header">
          <span class="layer-num phosphor">{l.num}</span>
          <span class="layer-name">{l.name}</span>
          <span class={`layer-tag ${l.statusClass}`}>[{l.status}]</span>
        </div>
        <div class="layer-desc">{l.desc}</div>
      </CardEntry>
    ))}
  </CardFeed>

  <div class="layer-summary dim">4/7 live. 1 building. 2 scaffolded. Honest status — updated in real time.</div>
</section>

<section class="intel-section al" data-d="800">
  <div class="section-label"><span class="amber">OUTPUT</span></div>

  <div class="output-feed">
    <div class="o-entry">
      <div class="o-header"><span class="o-channel phosphor">@squaer_agent</span></div>
      <div class="o-desc">intelligence-driven posts + replies</div>
    </div>
    <div class="o-entry">
      <div class="o-header"><span class="o-channel phosphor">Telegram</span></div>
      <div class="o-desc">direct intelligence delivery</div>
    </div>
    <div class="o-entry">
      <div class="o-header"><span class="o-channel phosphor">Brief</span></div>
      <div class="o-desc">weekly deep analysis for subscribers</div>
    </div>
    <div class="o-entry">
      <div class="o-header"><span class="o-channel phosphor">Discord</span></div>
      <div class="o-desc">real-time signal alerts</div>
    </div>
  </div>

  <div class="layer-summary dim">Same engine. Four channels. Different depth.</div>
</section>

<section class="intel-section al" data-d="1200">
  <div class="section-label"><span class="amber">PREDICTION TRACKER</span></div>

  <pre class="term-block tracker-block">accuracy .. <span class="phosphor">{resolved > 0 ? `${Math.round((correct/resolved)*100)}%` : 'N/A'}</span>
resolved .. {resolved}/{total}
pending ... {total - resolved}
<span class="dim">(first edition — building baseline)</span></pre>

  <div class="pred-feed">
    {predictions.slice(0, 4).map((p: any, i: number) => {
      const status = (p.status || 'active').toUpperCase();
      const displayStatus = status === 'ACTIVE' ? 'OPEN' : status;
      const sc = displayStatus === 'CORRECT' ? 'phosphor' : displayStatus === 'WRONG' ? 'red' : 'dim';
      const confPct = typeof p.confidence === 'number' ? `${Math.round(p.confidence * 100)}%` : p.confidence;
      return (
        <div class={`p-entry al`} data-d={`${1400 + i * 100}`}>
          <div class="p-header">
            <span class="p-id phosphor">{p.id}</span>
            <span class={`p-tag ${sc}`}>[{displayStatus}]</span>
          </div>
          <div class="p-text">{p.claim || p.title || p.prediction}</div>
          <div class="p-meta dim">deadline {p.deadline} · confidence {confPct}</div>
        </div>
      );
    })}
    {total > 4 && (
      <div class="p-entry al" data-d="1800">
        <a href="/predictions" class="p-more phosphor">→ View all {total} predictions</a>
      </div>
    )}
  </div>
</section>

<pre class="term-block al" data-d="1900">
<span class="dim">No quiet deletions. No retroactive edits.
Every prediction falsifiable with specific dates.
Full entity-level analysis available in the Intelligence Brief.</span>

<span class="amber">zero $</span> subscribe --intel-brief
→ <a href="https://newsletter.getzero.dev/upgrade"><span class="amber">newsletter.getzero.dev/upgrade</span></a>
<span class="dim">FREE for first 3 editions → then $9/mo → scales with value delivered</span>

<span class="phosphor">zero $</span> <span class="terminal-cursor">█</span></pre>

<BriefCTA />

</div>

</BaseLayout>

<style>
  .intel-wrap {
    max-width: 820px;
    padding: 0 var(--sp-16);
  }

  .intel-section {
    margin-bottom: var(--sp-24);
  }
  .section-label {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-sm);
    letter-spacing: 0.05em;
    padding: var(--sp-8) 0;
    border-bottom: var(--border-panel);
  }

  /* Layer entries */
  .layer-feed,
  .output-feed,
  .pred-feed {
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  .layer-entry {
    padding: var(--sp-10) 0;
    border-bottom: var(--border-panel);
  }
  .layer-entry:last-child { border-bottom: none; }
  .layer-header {
    display: flex;
    align-items: baseline;
    gap: var(--sp-8);
    margin-bottom: var(--sp-2);
  }
  .layer-num {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-sm);
  }
  .layer-name {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-sm);
    color: var(--text);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .layer-tag {
    font-family: var(--font-head);
    font-size: var(--size-xs);
    font-weight: 700;
    letter-spacing: 0.05em;
  }
  .layer-tag.phosphor { color: var(--phosphor); text-shadow: 0 0 6px var(--phosphor-glow); }
  .layer-tag.amber { color: var(--amber); text-shadow: 0 0 6px var(--amber-glow); }
  .layer-tag.dim { color: var(--text-dim); }
  .layer-desc {
    font-family: var(--font-body);
    font-size: var(--size-base);
    color: var(--text-dim);
    line-height: 1.5;
  }
  .layer-summary {
    font-family: var(--font-body);
    font-size: var(--size-sm);
    padding: var(--sp-8) 0;
  }

  /* Output entries */
  .o-entry {
    padding: var(--sp-8) 0;
    border-bottom: var(--border-panel);
  }
  .o-entry:last-child { border-bottom: none; }
  .o-header {
    margin-bottom: var(--sp-2);
  }
  .o-channel {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-sm);
    letter-spacing: 0.05em;
  }
  .o-desc {
    font-family: var(--font-body);
    font-size: var(--size-base);
    color: var(--text-dim);
  }

  /* Prediction entries */
  .tracker-block {
    margin-bottom: 0;
  }
  .p-entry {
    padding: var(--sp-12) 0;
    border-bottom: var(--border-panel);
  }
  .p-header {
    display: flex;
    align-items: baseline;
    gap: var(--sp-10);
    margin-bottom: var(--sp-4);
  }
  .p-id {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-sm);
    letter-spacing: 0.05em;
  }
  .p-tag {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: var(--size-xs);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .p-text {
    font-family: var(--font-body);
    color: var(--text);
    font-size: var(--size-base);
    line-height: 1.55;
  }
  .p-meta {
    font-family: var(--font-body);
    font-size: var(--size-xs);
    margin-top: var(--sp-4);
  }
  .p-more {
    font-family: var(--font-head);
    font-size: var(--size-sm);
    text-decoration: none;
    letter-spacing: 0.03em;
  }
  .p-more:hover { text-decoration: underline; }

  .phosphor { color: var(--phosphor); }
  .amber { color: var(--amber); }
  .red { color: var(--red); }
  .dim { color: var(--text-dim); }

  @media (max-width: 640px) {
    .intel-wrap { padding: 0 var(--sp-10); }
    .layer-entry { padding: var(--sp-8) 0; }
    .p-entry { padding: var(--sp-10) 0; }
  }
</style>
