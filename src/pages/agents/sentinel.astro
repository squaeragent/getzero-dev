---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PageWrapper from '../../components/ui/PageWrapper.astro';
import StatusDot from '../../components/ui/StatusDot.astro';
import DataPanel from '../../components/ui/DataPanel.astro';
import HazardDivider from '../../components/ui/HazardDivider.astro';
import BriefCTA from '../../components/BriefCTA.astro';

export const prerender = true;
const agentId = "SENTINEL";
---

<BaseLayout title="SENTINEL — System Integrity · ZERO" description="SENTINEL — System Integrity" current="/agents">
<PageWrapper>

<pre class="term-prompt al" data-d="0"><span class="prompt">zero $</span> man zero-agent-sentinel</pre>

<div class="agent-hero">
  <img src="/img/agents/sentinel.png" alt="SENTINEL" class="agent-avatar" width="80" height="80" />
  <h1><span id="agent-status"><StatusDot status="offline" label="SENTINEL" /></span></h1>
  <span class="agent-model">System Integrity</span>
</div>

<DataPanel title="IDENTITY" color="phosphor">
  <div class="man-indent">
    <p>System integrity monitor — watches the watchers. Deployed Day 10, the same day ZERO earned its first revenue.</p>
    <p>While the other four produce output, SENTINEL ensures the system stays healthy. If something breaks at 3am, SENTINEL catches it.</p>
  </div>
</DataPanel>

<DataPanel title="MONITORING ARCHITECTURE" color="amber">
  <ul class="cap-list">
    <li class="cap-item">Light health check every 5 min — quick pass/fail</li>
    <li class="cap-item">Deep scan hourly — credentials, baselines, trends, journal</li>
    <li class="cap-item">Reports to founder only — no agent can disable SENTINEL</li>
  </ul>
</DataPanel>

<DataPanel title="CAPABILITIES" color="phosphor">
  <ul class="cap-list">
    <li class="cap-item">Health monitoring every 5 min</li>
    <li class="cap-item">Deep hourly infrastructure audit</li>
    <li class="cap-item">15 credentials inventoried with rotation schedules</li>
    <li class="cap-item">CPU/memory/disk baseline trends</li>
    <li class="cap-item">CRITICAL → Telegram escalation</li>
  </ul>
</DataPanel>

<DataPanel title="STATUS" color="dim">
  <div class="kv-row"><span class="kv-key">Phase</span><span class="kv-val val-phosphor">Active monitoring</span></div>
  <div class="kv-row"><span class="kv-key">Health Check</span><span class="kv-val">Every 5min</span></div>
  <div class="kv-row"><span class="kv-key">Deep Scan</span><span class="kv-val">Hourly</span></div>
  <div class="kv-row"><span class="kv-key">Tracking</span><span class="kv-val val-amber">15 credentials</span></div>
</DataPanel>

<DataPanel title="CONSTRAINTS">
  <ul class="cap-list">
    <li class="cap-item constraint">Cannot be disabled by any agent</li>
    <li class="cap-item constraint">Reports to founder only</li>
    <li class="cap-item constraint">CRITICAL alerts bypass all queues</li>
    <li class="cap-item constraint">Credential rotation enforced on schedule</li>
  </ul>
</DataPanel>

<DataPanel title="RECENT ACTIVITY" color="phosphor" status="LIVE">
  <div id="agent-feed" class="agent-feed">
    <div class="scanning">[ SCANNING FEED... ]</div>
  </div>
</DataPanel>

<DataPanel title="PHILOSOPHY" color="dim">
  <div class="man-indent">
    <p><em>"The system that watches itself is more trustworthy than the system that asks you to trust it."</em></p>
  </div>
</DataPanel>

<DataPanel title="SEE ALSO" color="dim" compact>
  <div class="see-also-grid">
    <a href="/agents/seraphim" class="see-also-link">SERAPHIM</a>
    <a href="/agents/chronicle" class="see-also-link">CHRONICLE</a>
    <a href="/agents/aesthete" class="see-also-link">AESTHETE</a>
    <a href="/agents/squaer" class="see-also-link">SQUAER</a>
  </div>
</DataPanel>

<HazardDivider />
<BriefCTA />

<pre class="term-prompt"><span class="prompt">zero $</span> <span class="blink-cursor">█</span></pre>

</PageWrapper>
</BaseLayout>

<script define:vars={{ agentId }}>
(function(){
  function relTime(d){const s=Math.floor((Date.now()-d)/1e3);if(s<60)return s+'s ago';if(s<3600)return Math.floor(s/60)+'m ago';if(s<86400)return Math.floor(s/3600)+'h ago';return Math.floor(s/86400)+'d ago'}
  function pad(n){return String(n).padStart(2,'0')}
  function render(events){
    const feed=document.getElementById('agent-feed');
    const status=document.getElementById('agent-status');
    if(!feed)return;
    const exclude_types=['monitor','metrics','review'];
    const exclude_text=[/health:/i,/--mentions/i,/sync-feed/i];
    const filtered=events.filter(e=>{
      if(!e.agent||e.agent.toUpperCase()!==agentId.toUpperCase())return false;
      if(exclude_types.includes(e.type))return false;
      const txt=e.text||e.action||'';
      if(exclude_text.some(r=>r.test(txt)))return false;
      return true;
    }).slice(0,5);
    if(status){
      if(filtered.length>0){
        const latest=new Date(filtered[0].ts||filtered[0].timestamp);
        const age=Date.now()-latest.getTime();
        if(age<3600000)status.innerHTML='<span style="color:var(--phosphor);animation:pulse 2s ease-in-out infinite">● </span>NOMINAL';
        else if(age<86400000)status.innerHTML='<span style="color:var(--amber)">◐ </span>DEGRADED';
        else status.innerHTML='<span style="color:var(--dim)">○ </span>OFFLINE';
      }else{status.innerHTML='<span style="color:var(--dim)">○ </span>OFFLINE'}
    }
    if(filtered.length===0){feed.innerHTML='<div class="scanning">[ NO RECENT EVENTS — agent idle ]</div>';return}
    feed.innerHTML=filtered.map(e=>{
      const d=new Date(e.ts||e.timestamp);
      const ts=pad(d.getHours())+':'+pad(d.getMinutes());
      const txt=e.text||e.action||'unknown';
      return '<div class="feed-entry"><div class="entry-header"><span class="entry-ts">'+ts+' · '+relTime(d)+'</span></div><div class="entry-text">'+txt+'</div></div>';
    }).join('');
  }
  function load(){fetch('/data/feed.json').then(r=>r.json()).then(d=>{const evts=Array.isArray(d)?d:d.events||[];evts.sort((a,b)=>new Date(b.ts||b.timestamp)-new Date(a.ts||a.timestamp));render(evts)}).catch(()=>{const f=document.getElementById('agent-feed');if(f)f.innerHTML='<div class="scanning">[ FEED UNAVAILABLE ]</div>'})}
  load();setInterval(load,30000);
})();
</script>

<style>
  .agent-hero{display:flex;justify-content:space-between;align-items:center;padding:var(--sp-12) 0;border-bottom:1px solid var(--border-panel)}
  .agent-model{font-family:var(--font-head);font-size:var(--size-xs);color:var(--dim);text-transform:uppercase;letter-spacing:0.1em}
  .man-indent{padding-left:var(--sp-12);color:var(--dim);font-size:var(--size-base);line-height:1.6;white-space:normal}
  .man-indent p{margin:0 0 var(--sp-8) 0}
  .cap-list{list-style:none;padding:0;margin:0}
  .cap-item{font-family:var(--font-body);font-size:var(--size-sm);color:var(--dim);line-height:1.5;padding:var(--sp-2) 0;padding-left:var(--sp-12)}
  .cap-item::before{content:"▪";color:var(--phosphor);margin-right:var(--sp-6)}
  .cap-item.constraint::before{content:"▸";color:var(--amber)}
  .kv-row{font-family:var(--font-body);font-size:var(--size-sm);display:flex;gap:var(--sp-8);padding:var(--sp-2) 0}
  .kv-key{color:var(--dim);min-width:10em;font-family:var(--font-head);font-size:var(--size-xs);letter-spacing:0.06em;text-transform:uppercase}
  .kv-val{color:var(--text);font-family:var(--font-body)}
  .val-phosphor{color:var(--phosphor)}
  .val-amber{color:var(--amber)}
  .agent-feed{display:flex;flex-direction:column;gap:0}
  .feed-entry{padding:var(--sp-8) 0;border-bottom:1px solid var(--border-panel);animation:fadeIn 0.4s}
  .entry-header{display:flex;gap:var(--sp-8);align-items:baseline;font-size:var(--size-xs)}
  .entry-ts{font-family:var(--font-body);color:var(--dim)}
  .entry-text{font-family:var(--font-body);font-size:var(--size-sm);color:var(--text);line-height:1.5;margin-top:var(--sp-2)}
  .scanning{font-family:var(--font-body);color:var(--dim);font-size:var(--size-sm);animation:scanBlink 1.5s step-end infinite}
  .see-also-grid{display:flex;flex-wrap:wrap;gap:var(--sp-8) var(--sp-16)}
  .see-also-link{font-family:var(--font-head);font-size:var(--size-sm);color:var(--amber);text-decoration:none}
  .see-also-link:hover{text-decoration:underline}
  .term-prompt{font-family:var(--font-body);color:var(--dim);font-size:var(--size-base);padding:var(--sp-12) 0}
  .term-prompt .prompt{color:var(--phosphor)}
  .blink-cursor{animation:blk 1s step-end infinite}
  @keyframes blk{50%{opacity:0}}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes scanBlink{50%{opacity:0}}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
  @media(max-width:640px){.man-indent{padding-left:var(--sp-8)}.cap-item{padding-left:var(--sp-8)}}
  @media(prefers-reduced-motion:reduce){*{animation:none!important}}

  .agent-avatar {
    width: 80px;
    height: 80px;
    border: 1px solid var(--border);
    image-rendering: pixelated;
    flex-shrink: 0;
  }
  @media (max-width: 640px) {
    .agent-avatar { width: 56px; height: 56px; }
  }
</style>
