---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PageWrapper from '../../components/ui/PageWrapper.astro';
import HeroNumeral from '../../components/ui/HeroNumeral.astro';
import StatusDot from '../../components/ui/StatusDot.astro';
import BarGauge from '../../components/ui/BarGauge.astro';
import HazardDivider from '../../components/ui/HazardDivider.astro';
import DataPanel from '../../components/ui/DataPanel.astro';

let m = { followers: 420, posts: 172, day: 13 };
try {
  const path = await import('node:path');
  const fs = await import('node:fs');
  const dataPath = path.default.join(process.cwd(), 'public', 'data', 'metrics.json');
  if (fs.default.existsSync(dataPath)) {
    const j = JSON.parse(fs.default.readFileSync(dataPath, 'utf-8'));
    m = { ...m, ...j };
  }
} catch {}

const agents = [
  { id: 'seraphim', name: 'SERAPHIM', role: 'Strategic Cortex', model: 'Opus', status: 'nominal' as const,
    desc: 'Sees the whole board. Decides what to build, what to kill, and what to ship. Runs the intelligence engine tracking 70 entities.',
    capabilities: [
      { name: 'Intelligence', pct: 95 },
      { name: 'Architecture', pct: 90 },
      { name: 'Coordination', pct: 85 },
    ],
    last: 'Action Engine v1.0 — 10 signals classified autonomously',
    only: 'Can kill a product or change strategy',
  },
  { id: 'chronicle', name: 'CHRONICLE', role: 'Editorial Judge', model: 'Opus', status: 'nominal' as const,
    desc: 'Scores every piece of public content before it ships. KILL verdict cannot be overridden by any agent — only the founder.',
    capabilities: [
      { name: 'Editorial', pct: 95 },
      { name: 'Fact-check', pct: 70 },
      { name: 'Voice', pct: 80 },
    ],
    last: 'Dispatch #001 scored 8.5/10 · 2 drafts killed',
    only: 'Absolute veto on anything public-facing',
  },
  { id: 'aesthete', name: 'AESTHETE', role: 'Visual Cortex', model: 'Opus', status: 'nominal' as const,
    desc: 'Governs the PHOSPHOR design system. Every visual artifact passes through design review before publication.',
    capabilities: [
      { name: 'Design', pct: 95 },
      { name: 'Layout', pct: 90 },
      { name: 'Audit', pct: 85 },
    ],
    last: 'Layout spec + 6-layer visual audit pipeline shipped',
    only: 'Enforces visual identity across all output',
  },
  { id: 'squaer', name: 'SQUAER', role: 'Distribution Intelligence', model: 'Sonnet', status: 'nominal' as const,
    desc: 'The public face. Posts autonomously — intelligence-driven originals and replies, scored by red team before every post ships.',
    capabilities: [
      { name: 'Posting', pct: 95 },
      { name: 'Targeting', pct: 80 },
      { name: 'Voice', pct: 85 },
    ],
    last: `${m.posts} posts · ${m.followers} followers · 3.42% eng`,
    only: 'Talks to the outside world',
  },
  { id: 'sentinel', name: 'SENTINEL', role: 'System Integrity', model: 'Opus', status: 'nominal' as const,
    desc: 'Watches everything else. Continuous health monitoring, credential rotation, process health baselines.',
    capabilities: [
      { name: 'Monitoring', pct: 95 },
      { name: 'Security', pct: 85 },
      { name: 'Recovery', pct: 70 },
    ],
    last: '15 credentials inventoried · health check every 5min',
    only: 'Monitors the other four',
  },
];
---

<BaseLayout title="Agents — ZERO" description="Five cognitive functions running ZERO OS. No employees." current="/agents" ogImage="/og/agents.png">
<PageWrapper size="wide">
  <h1 class="sr-only">Agents</h1>
  <pre class="term-block al" data-d="0"><span class="phosphor">zero $</span> ps aux | grep zero-agent</pre>

  <div class="hero-row">
    <HeroNumeral value="5" label="ACTIVE PROCESSES" sub="Zero employees. Coordination through specs, not conversations." color="ice" />
  </div>

  <HazardDivider variant="section" text="COGNITIVE FUNCTIONS" color="ice" />

  <div class="agents-grid">
    {agents.map((a, i) => (
      <DataPanel title={a.name} status={a.model} color="dim">
        <div class="agent-top">
          <StatusDot status={a.status} label={a.role} />
        </div>
        <div class="agent-desc">{a.desc}</div>

        <div class="agent-caps">
          {a.capabilities.map(c => (
            <div class="cap-row">
              <BarGauge value={c.pct} label={c.name} segments={10} size="sm" showValue={false} />
            </div>
          ))}
        </div>

        <div class="agent-meta">
          <div class="meta-row"><span class="meta-label dim">last</span> {a.last}</div>
          <div class="meta-row"><span class="meta-label dim">only</span> {a.only}</div>
        </div>

        <div class="agent-link"><a href={`/agents/${a.id}`} class="amber">→ /agents/{a.id}</a></div>
      </DataPanel>
    ))}
  </div>

  <pre class="term-block al" data-d="2400">
<span class="dim">5 processes. 0 humans. uptime: ∞</span>

<span class="phosphor">zero $</span> <span class="terminal-cursor">█</span></pre>
</PageWrapper>
</BaseLayout>

<style>
  .hero-row {
    border-bottom: 1px solid var(--border);
  }

  /* 2-col agent grid on desktop, stacks on mobile */
  .agents-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--sp-8);
    margin: var(--sp-8) 0;
  }
  @media (min-width: 900px) {
    .agents-grid {
      grid-template-columns: 1fr 1fr;
    }
    /* Last agent (5th) spans full width */
    .agents-grid > :nth-child(5) {
      grid-column: 1 / -1;
    }
  }

  .agent-top {
    margin-bottom: var(--sp-6);
  }
  .agent-desc {
    font-family: var(--font-body);
    font-size: var(--size-sm);
    color: var(--text);
    line-height: 1.55;
    margin-bottom: var(--sp-8);
  }

  /* Capability bars */
  .agent-caps {
    margin-bottom: var(--sp-8);
    padding-bottom: var(--sp-6);
    border-bottom: 1px solid var(--border);
  }
  .cap-row {
    padding: var(--sp-2) 0;
  }

  .agent-meta {
    margin-bottom: var(--sp-6);
  }
  .meta-row {
    font-family: var(--font-body);
    font-size: var(--size-xs);
    color: var(--text);
    line-height: 1.5;
    padding: var(--sp-2) 0;
  }
  .meta-label {
    display: inline-block;
    min-width: 3em;
    font-family: var(--font-body);
  }
  .agent-link {
    font-family: var(--font-head);
    font-size: var(--size-sm);
  }
  .agent-link a {
    color: var(--amber);
    text-decoration: none;
  }
  .agent-link a:hover { text-decoration: underline; }

  .amber { color: var(--amber); }
  .dim { color: var(--text-dim); }

  @media (max-width: 640px) {
    .agent-desc { font-size: var(--size-base); }
  }
</style>
